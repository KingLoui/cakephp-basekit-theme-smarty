!function($){function e(e){function t(e,i,s){A||(A=!0,v=e.getCanvas(),b=$(v).parent(),w=e.getOptions(),e.setData(r(e.getData())))}function r(e){for(var i=0,s=0,t=0,r=w.series.pie.combine.color,a=[],l=0;l<e.length;++l){var n=e[l].data;$.isArray(n)&&1==n.length&&(n=n[0]),$.isArray(n)?!isNaN(parseFloat(n[1]))&&isFinite(n[1])?n[1]=+n[1]:n[1]=0:n=!isNaN(parseFloat(n))&&isFinite(n)?[1,+n]:[1,0],e[l].data=[n]}for(var l=0;l<e.length;++l)i+=e[l].data[0][1];for(var l=0;l<e.length;++l){var n=e[l].data[0][1];n/i<=w.series.pie.combine.threshold&&(s+=n,t++,r||(r=e[l].color))}for(var l=0;l<e.length;++l){var n=e[l].data[0][1];(t<2||n/i>w.series.pie.combine.threshold)&&a.push($.extend(e[l],{data:[[1,n]],color:e[l].color,label:e[l].label,angle:n*Math.PI*2/i,percent:n/(i/100)}))}return t>1&&a.push({data:[[1,s]],color:r,label:w.series.pie.combine.label,angle:s*Math.PI*2/i,percent:s/(i/100)}),a}function a(e,t){function r(){y.clearRect(0,0,o,p),b.children().filter(".pieLabel, .pieLabelBackground").remove()}function a(){var e=w.series.pie.shadow.left,i=w.series.pie.shadow.top,s=10,t=w.series.pie.shadow.alpha,r=w.series.pie.radius>1?w.series.pie.radius:k*w.series.pie.radius;if(!(r>=o/2-e||r*w.series.pie.tilt>=p/2-i||r<=s)){y.save(),y.translate(e,i),y.globalAlpha=t,y.fillStyle="#000",y.translate(M,P),y.scale(1,w.series.pie.tilt);for(var a=1;a<=s;a++)y.beginPath(),y.arc(0,0,r,0,2*Math.PI,!1),y.fill(),r-=a;y.restore()}}function n(){function e(e,i,s){e<=0||isNaN(e)||(s?y.fillStyle=i:(y.strokeStyle=i,y.lineJoin="round"),y.beginPath(),Math.abs(e-2*Math.PI)>1e-9&&y.moveTo(0,0),y.arc(0,0,t,r,r+e/2,!1),y.arc(0,0,t,r+e/2,r+e,!1),y.closePath(),r+=e,s?y.fill():y.stroke())}function i(){function e(e,i,s){if(0==e.data[0][1])return!0;var r=w.legend.labelFormatter,a,l=w.series.pie.label.formatter;a=r?r(e.label,e):e.label,l&&(a=l(a,e));var n=(i+e.angle+i)/2,h=M+Math.round(Math.cos(n)*t),g=P+Math.round(Math.sin(n)*t)*w.series.pie.tilt,c="<span class='pieLabel' id='pieLabel"+s+"' style='position:absolute;top:"+g+"px;left:"+h+"px;'>"+a+"</span>";b.append(c);var u=b.children("#pieLabel"+s),d=g-u.height()/2,f=h-u.width()/2;if(u.css("top",d),u.css("left",f),0-d>0||0-f>0||p-(d+u.height())<0||o-(f+u.width())<0)return!1;if(0!=w.series.pie.label.background.opacity){var v=w.series.pie.label.background.color;null==v&&(v=e.color);var k="top:"+d+"px;left:"+f+"px;";$("<div class='pieLabelBackground' style='position:absolute;width:"+u.width()+"px;height:"+u.height()+"px;"+k+"background-color:"+v+";'></div>").css("opacity",w.series.pie.label.background.opacity).insertBefore(u)}return!0}for(var i=s,t=w.series.pie.label.radius>1?w.series.pie.label.radius:k*w.series.pie.label.radius,r=0;r<g.length;++r){if(g[r].percent>=100*w.series.pie.label.threshold&&!e(g[r],i,r))return!1;i+=g[r].angle}return!0}var s=Math.PI*w.series.pie.startAngle,t=w.series.pie.radius>1?w.series.pie.radius:k*w.series.pie.radius;y.save(),y.translate(M,P),y.scale(1,w.series.pie.tilt),y.save();for(var r=s,a=0;a<g.length;++a)g[a].startAngle=r,e(g[a].angle,g[a].color,!0);if(y.restore(),w.series.pie.stroke.width>0){y.save(),y.lineWidth=w.series.pie.stroke.width,r=s;for(var a=0;a<g.length;++a)e(g[a].angle,w.series.pie.stroke.color,!1);y.restore()}return l(y),y.restore(),!w.series.pie.label.show||i()}if(b){var o=e.getPlaceholder().width(),p=e.getPlaceholder().height(),h=b.children().filter(".legend").children().width()||0;y=t,A=!1,k=Math.min(o,p/w.series.pie.tilt)/2,P=p/2+w.series.pie.offset.top,M=o/2,"auto"==w.series.pie.offset.left?(w.legend.position.match("w")?M+=h/2:M-=h/2,M<k?M=k:M>o-k&&(M=o-k)):M+=w.series.pie.offset.left;var g=e.getData(),c=0;do c>0&&(k*=s),c+=1,r(),w.series.pie.tilt<=.8&&a();while(!n()&&c<i);c>=i&&(r(),b.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>")),e.setSeries&&e.insertLegend&&(e.setSeries(g),e.insertLegend())}}function l(e){if(w.series.pie.innerRadius>0){e.save();var i=w.series.pie.innerRadius>1?w.series.pie.innerRadius:k*w.series.pie.innerRadius;e.globalCompositeOperation="destination-out",e.beginPath(),e.fillStyle=w.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.fill(),e.closePath(),e.restore(),e.save(),e.beginPath(),e.strokeStyle=w.series.pie.stroke.color,e.arc(0,0,i,0,2*Math.PI,!1),e.stroke(),e.closePath(),e.restore()}}function n(e,i){for(var s=!1,t=-1,r=e.length,a=r-1;++t<r;a=t)(e[t][1]<=i[1]&&i[1]<e[a][1]||e[a][1]<=i[1]&&i[1]<e[t][1])&&i[0]<(e[a][0]-e[t][0])*(i[1]-e[t][1])/(e[a][1]-e[t][1])+e[t][0]&&(s=!s);return s}function o(i,s){for(var t=e.getData(),r=e.getOptions(),a=r.series.pie.radius>1?r.series.pie.radius:k*r.series.pie.radius,l,o,p=0;p<t.length;++p){var h=t[p];if(h.pie.show){if(y.save(),y.beginPath(),y.moveTo(0,0),y.arc(0,0,a,h.startAngle,h.startAngle+h.angle/2,!1),y.arc(0,0,a,h.startAngle+h.angle/2,h.startAngle+h.angle,!1),y.closePath(),l=i-M,o=s-P,y.isPointInPath){if(y.isPointInPath(i-M,s-P))return y.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:p}}else{var g=a*Math.cos(h.startAngle),c=a*Math.sin(h.startAngle),u=a*Math.cos(h.startAngle+h.angle/4),d=a*Math.sin(h.startAngle+h.angle/4),f=a*Math.cos(h.startAngle+h.angle/2),v=a*Math.sin(h.startAngle+h.angle/2),b=a*Math.cos(h.startAngle+h.angle/1.5),w=a*Math.sin(h.startAngle+h.angle/1.5),A=a*Math.cos(h.startAngle+h.angle),m=a*Math.sin(h.startAngle+h.angle),I=[[0,0],[g,c],[u,d],[f,v],[b,w],[A,m]],x=[l,o];if(n(I,x))return y.restore(),{datapoint:[h.percent,h.data],dataIndex:0,series:h,seriesIndex:p}}y.restore()}}return null}function p(e){g("plothover",e)}function h(e){g("plotclick",e)}function g(i,s){var t=e.offset(),r=parseInt(s.pageX-t.left),a=parseInt(s.pageY-t.top),l=o(r,a);if(w.grid.autoHighlight)for(var n=0;n<m.length;++n){var p=m[n];p.auto!=i||l&&p.series==l.series||u(p.series)}l&&c(l.series,i);var h={pageX:s.pageX,pageY:s.pageY};b.trigger(i,[h,l])}function c(i,s){var t=d(i);t==-1?(m.push({series:i,auto:s}),e.triggerRedrawOverlay()):s||(m[t].auto=!1)}function u(i){null==i&&(m=[],e.triggerRedrawOverlay());var s=d(i);s!=-1&&(m.splice(s,1),e.triggerRedrawOverlay())}function d(e){for(var i=0;i<m.length;++i){var s=m[i];if(s.series==e)return i}return-1}function f(e,i){function s(e){e.angle<=0||isNaN(e.angle)||(i.fillStyle="rgba(255, 255, 255, "+t.series.pie.highlight.opacity+")",i.beginPath(),Math.abs(e.angle-2*Math.PI)>1e-9&&i.moveTo(0,0),i.arc(0,0,r,e.startAngle,e.startAngle+e.angle/2,!1),i.arc(0,0,r,e.startAngle+e.angle/2,e.startAngle+e.angle,!1),i.closePath(),i.fill())}var t=e.getOptions(),r=t.series.pie.radius>1?t.series.pie.radius:k*t.series.pie.radius;i.save(),i.translate(M,P),i.scale(1,t.series.pie.tilt);for(var a=0;a<m.length;++a)s(m[a].series);l(i),i.restore()}var v=null,b=null,w=null,k=null,M=null,P=null,A=!1,y=null,m=[];e.hooks.processOptions.push(function(e,i){i.series.pie.show&&(i.grid.show=!1,"auto"==i.series.pie.label.show&&(i.legend.show?i.series.pie.label.show=!1:i.series.pie.label.show=!0),"auto"==i.series.pie.radius&&(i.series.pie.label.show?i.series.pie.radius=.75:i.series.pie.radius=1),i.series.pie.tilt>1?i.series.pie.tilt=1:i.series.pie.tilt<0&&(i.series.pie.tilt=0))}),e.hooks.bindEvents.push(function(e,i){var s=e.getOptions();s.series.pie.show&&(s.grid.hoverable&&i.unbind("mousemove").mousemove(p),s.grid.clickable&&i.unbind("click").click(h))}),e.hooks.processDatapoints.push(function(e,i,s,r){var a=e.getOptions();a.series.pie.show&&t(e,i,s,r)}),e.hooks.drawOverlay.push(function(e,i){var s=e.getOptions();s.series.pie.show&&f(e,i)}),e.hooks.draw.push(function(e,i){var s=e.getOptions();s.series.pie.show&&a(e,i)})}var i=10,s=.95,t={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(e,i){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+i.color+";'>"+e+"<br/>"+Math.round(i.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}};$.plot.plugins.push({init:e,options:t,name:"pie",version:"1.1"})}(jQuery);